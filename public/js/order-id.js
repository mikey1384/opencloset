// Generated by CoffeeScript 1.6.3
(function() {
  $(function() {
    var updateLateFee;
    updateLateFee = function() {
      var order_id;
      order_id = $('#order').data('order-id');
      return $.ajax("/api/order/" + order_id + ".json", {
        type: 'GET',
        success: function(data, textStatus, jqXHR) {
          var compiled;
          compiled = _.template($('#tpl-late-fee').html());
          $("#late-fee").html($(compiled(data)));
          return $('#order-late-fee-pay-with').editable({
            source: function() {
              var m, result, _i, _len, _ref;
              result = [];
              _ref = ['현금', '카드', '현금+카드'];
              for (_i = 0, _len = _ref.length; _i < _len; _i++) {
                m = _ref[_i];
                result.push({
                  value: m,
                  text: m
                });
              }
              return result;
            }
          });
        },
        error: function(jqXHR, textStatus, errorThrown) {},
        complete: function(jqXHR, textStatus) {}
      });
    };
    updateLateFee();
    $('span.order-status.label').each(function(i, el) {
      $(el).addClass(OpenCloset.getStatusCss($(el).data('order-detail-status')));
      if ($(el).data('order-detail-status') === '대여중' && $(el).data('order-late-fee') > 0) {
        return $(el).html('연체중');
      }
    });
    $('#order-staff-name').editable();
    $('#order-rental-date').editable({
      combodate: {
        minYear: 2013
      }
    });
    $('#order-target-date').editable({
      combodate: {
        minYear: 2013
      },
      success: function(response, newValue) {
        return updateLateFee();
      }
    });
    $('#order-price-pay-with').editable({
      source: function() {
        var m, result, _i, _len, _ref;
        result = [];
        _ref = ['현금', '카드', '현금+카드'];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          m = _ref[_i];
          result.push({
            value: m,
            text: m
          });
        }
        return result;
      }
    });
    $('.order-detail').editable();
    $('#order-desc').editable();
    return $('#btn-order-confirm').click(function(e) {
      var order_id, redirect_url, url;
      url = $(e.target).data('url');
      order_id = $(e.target).data('order-id');
      redirect_url = $(e.target).data('redirect-url');
      if (!url) {
        return;
      }
      if (!order_id) {
        return;
      }
      return $.ajax(url, {
        type: 'POST',
        data: {
          id: order_id,
          name: 'status_id',
          value: 2,
          pk: order_id
        },
        success: function(data, textStatus, jqXHR) {
          return window.location.href = redirect_url;
        },
        error: function(jqXHR, textStatus, errorThrown) {
          return alert('error', jqXHR.responseJSON.error);
        },
        complete: function(jqXHR, textStatus) {}
      });
    });
  });

}).call(this);
