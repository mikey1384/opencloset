// Generated by CoffeeScript 1.6.3
(function() {
  $(function() {
    $('#clothes-id').focus();
    $('#btn-clear').click(function(e) {
      e.preventDefault();
      $('#clothes-table table tbody tr').remove();
      $('#action-buttons').hide();
      return $('#clothes-id').focus();
    });
    $('#btn-clothes-search').click(function(e) {
      return $('#clothes-search-form').trigger('submit');
    });
    $('#clothes-search-form').submit(function(e) {
      var clothes_id;
      e.preventDefault();
      clothes_id = $('#clothes-id').val();
      $('#clothes-id').val('').focus();
      if (!clothes_id) {
        return;
      }
      return $.ajax("/api/clothes/" + clothes_id + ".json", {
        type: 'GET',
        dataType: 'json',
        success: function(data, textStatus, jqXHR) {
          var $html, compiled, html;
          console.log(data);
          data.code = data.code.replace(/^0/, '');
          if (data.status === '대여중') {
            if ($("#clothes-table table tbody tr[data-order-id='" + data.order.id + "']").length) {
              return;
            }
            compiled = _.template($('#tpl-row-checkbox-clothes-with-order').html());
            $html = $(compiled(data));
            $html.find('.order-status').addClass('label-important');
            if (data.order.overdue) {
              compiled = _.template($('#tpl-overdue-paragraph').html());
              html = compiled(data);
              $html.find("td:last-child").append(html);
            }
            return $("#clothes-table table tbody").append($html);
          } else {
            if ($("#clothes-table table tbody tr[data-clothes-code='" + data.code + "']").length) {
              return;
            }
            compiled = _.template($('#tpl-row-checkbox-clothes').html());
            $html = $(compiled(data));
            $('#clothes-table table tbody').append($html);
            if (data.status === '대여가능') {
              $html.find('.order-status').addClass('label-success');
              return $('#action-buttons').show();
            }
          }
        },
        error: function(jqXHR, textStatus, errorThrown) {
          return alert('error', jqXHR.responseJSON.error);
        },
        complete: function(jqXHR, textStatus) {}
      });
    });
    $('#action-buttons').on('click', 'button:not(.disabled)', function(e) {
      var $this, clothes, status;
      $this = $(this);
      $this.addClass('disabled');
      status = $this.data('status');
      clothes = [];
      alert('hello');
      $('#clothes-table input:checked').each(function(i, el) {
        clothes.push($(el).data('clothes-id'));
        console.log($(el));
        return console.log($(i));
      });
      alert('world');
      clothes = _.uniq(clothes);
      $.ajax("/clothes.json", {
        type: 'PUT',
        data: {
          status: status,
          clothes: clothes.join()
        },
        dataType: 'json',
        success: function(data, textStatus, jqXHR) {
          $('#clothes-list input:checked').each(function(i, el) {
            return $(el).closest('.row-checkbox').remove();
          });
          if (!$('#clothes-list .row-checkbox').length) {
            $('#action-buttons').hide();
          }
          return alert('success', "" + clothes.length + "개의 항목이 " + status + " (으)로 변경되었습니다");
        },
        error: function(jqXHR, textStatus, errorThrown) {
          return alert('error', jqXHR.responseJSON.error);
        },
        complete: function(jqXHR, textStatus) {
          return $this.removeClass('disabled');
        }
      });
      return $('#clothes-id').focus();
    });
    return $('#input-check-all').click(function(e) {
      var is_checked;
      is_checked = $('#input-check-all').is(':checked');
      return $(this).closest('thead').next().find('.ace:checkbox:not(:disabled)').prop('checked', is_checked);
    });
  });

}).call(this);
