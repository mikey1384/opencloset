// Generated by CoffeeScript 1.6.3
(function() {
  $(function() {
    $('#cloth-id').focus();
    $('#btn-clear').click(function(e) {
      e.preventDefault();
      $('#clothes-list ul li').remove();
      $('#action-buttons').hide();
      return $('#cloth-id').focus();
    });
    $('#btn-cloth-search').click(function(e) {
      return $('#cloth-search-form').trigger('submit');
    });
    $('#cloth-search-form').submit(function(e) {
      var cloth_id;
      e.preventDefault();
      cloth_id = $('#cloth-id').val();
      $('#cloth-id').val('').focus();
      if (!cloth_id) {
        return;
      }
      return $.ajax("/clothes/" + cloth_id + ".json", {
        type: 'GET',
        dataType: 'json',
        success: function(data, textStatus, jqXHR) {
          var $html, compiled;
          if ($("#cloth-table table tbody tr[data-cloth-id='" + data.id + "']").length) {
            return;
          }
          if (!/^(대여중|연체중|부분반납)/.test(data.status)) {
            compiled = _.template($('#tpl-row-checkbox-enabled').html());
            $html = $(compiled(data));
            if (/대여가능/.test(data.status)) {
              $html.find('.order-status').addClass('label-success');
            }
            $('#cloth-table table tbody').append($html);
            return $('#action-buttons').show();
          } else {
            compiled = _.template($('#tpl-row-checkbox-disabled').html());
            $html = $(compiled(data));
            if (/연체중/.test(data.status)) {
              $html.find('.order-status').addClass('label-important');
            }
            return $("#cloth-table table tbody").append($html);
          }
        },
        error: function(jqXHR, textStatus, errorThrown) {
          return alert('error', jqXHR.responseJSON.error);
        },
        complete: function(jqXHR, textStatus) {}
      });
    });
    $('#input-check-all').click(function(e) {
      var is_checked;
      is_checked = $('#input-check-all').is(':checked');
      return $(this).closest('thead').next().find('.ace:checkbox:not(:disabled)').prop('checked', is_checked);
    });
    return $('#action-buttons').on('click', 'button:not(.disabled)', function(e) {
      if (!$('input[name=gid]:checked').val()) {
        return alert('대여자님을 선택해 주세요');
      }
      if (!$('input[name=cloth-id]:checked').val()) {
        return alert('선택하신 주문상품이 없습니다');
      }
      return $('#order-form').submit();
    });
  });

}).call(this);
